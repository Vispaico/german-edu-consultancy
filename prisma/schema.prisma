generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"  // Change to "postgresql" for production
  url      = env("DATABASE_URL")
}

// User Models
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String
  phone         String?
  role          Role      @default(STUDENT)
  emailVerified DateTime?
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  student       Student?
  consultant    Consultant?
  sessions      Session[]
  verificationTokens VerificationToken[]
}

enum Role {
  STUDENT
  CONSULTANT
  ADMIN
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  id         String   @id @default(cuid())
  identifier String
  token      String   @unique
  expires    DateTime
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([identifier, token])
}

// Student Profile
model Student {
  id               String   @id @default(cuid())
  userId           String   @unique
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Personal Information
  firstName        String
  lastName         String
  dateOfBirth      DateTime
  nationality      String   @default("Vietnam")
  passportNumber   String?
  gender           String?
  address          String?
  city             String?
  
  // Academic Information
  education        String?
  major            String?
  gpa              Float?
  
  // English Test Scores
  ieltsScore       Float?
  toeflScore       Int?
  pteScore         Int?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  applications     Application[]
  documents        Document[]
  testBookings     TestBooking[]
  messages         Message[]
  payments         Payment[]
}

// Consultant Profile
model Consultant {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  specialization String?
  experience     Int?     // Years of experience
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  applications Application[]
  messages     Message[]
}

// University
model University {
  id              String   @id @default(cuid())
  name            String
  nameVi          String?
  slug            String   @unique
  city            String
  state           String
  country         String   @default("Australia")
  
  logo            String?
  website         String?
  ranking         Int?
  
  description     String?
  descriptionVi   String?
  
  tuitionMin      Int?     // AUD per year
  tuitionMax      Int?
  
  requirements    String?  // JSON string for requirements
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  courses         Course[]
  applications    Application[]
}

// Course/Program
model Course {
  id            String   @id @default(cuid())
  universityId  String
  university    University @relation(fields: [universityId], references: [id], onDelete: Cascade)
  
  name          String
  nameVi        String?
  degree        String   // Bachelor, Master, PhD
  duration      Int      // Months
  tuition       Int      // AUD per year
  
  description   String?
  requirements  String?  // JSON string
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  applications  Application[]
}

// Application
model Application {
  id              String   @id @default(cuid())
  studentId       String
  student         Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  universityId    String
  university      University @relation(fields: [universityId], references: [id])
  
  courseId        String?
  course          Course?  @relation(fields: [courseId], references: [id])
  
  consultantId    String?
  consultant      Consultant? @relation(fields: [consultantId], references: [id])
  
  // Application Details
  status          ApplicationStatus @default(DRAFT)
  intake          String   // e.g., "February 2025"
  visaStatus      VisaStatus @default(NOT_STARTED)
  
  // Tracking
  submittedAt     DateTime?
  offerReceivedAt DateTime?
  visaAppliedAt   DateTime?
  visaApprovedAt  DateTime?
  
  notes           String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  documents       Document[]
  payments        Payment[]
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  OFFER_RECEIVED
  OFFER_ACCEPTED
  VISA_PROCESSING
  APPROVED
  REJECTED
  WITHDRAWN
}

enum VisaStatus {
  NOT_STARTED
  DOCUMENTS_PREPARATION
  SUBMITTED
  BIOMETRICS_DONE
  MEDICAL_DONE
  PROCESSING
  APPROVED
  REJECTED
}

// Document
model Document {
  id              String   @id @default(cuid())
  studentId       String
  student         Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  applicationId   String?
  application     Application? @relation(fields: [applicationId], references: [id])
  
  type            DocumentType
  name            String
  fileName        String
  fileUrl         String
  fileSize        Int      // Bytes
  
  status          DocumentStatus @default(PENDING)
  verifiedAt      DateTime?
  verifiedBy      String?
  
  notes           String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

enum DocumentType {
  PASSPORT
  TRANSCRIPT
  DIPLOMA
  IELTS_CERTIFICATE
  TOEFL_CERTIFICATE
  PTE_CERTIFICATE
  RECOMMENDATION_LETTER
  PERSONAL_STATEMENT
  CV
  FINANCIAL_PROOF
  BIRTH_CERTIFICATE
  VISA_APPLICATION
  MEDICAL_CERTIFICATE
  POLICE_CHECK
  OTHER
}

enum DocumentStatus {
  PENDING
  VERIFIED
  REJECTED
  EXPIRED
}

// Language Test Booking
model TestBooking {
  id          String   @id @default(cuid())
  studentId   String
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  testType    TestType
  testCenter  String
  location    String
  testDate    DateTime
  
  registrationId String?
  status      BookingStatus @default(PENDING)
  
  score       Float?
  resultDate  DateTime?
  
  notes       String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum TestType {
  IELTS_ACADEMIC
  IELTS_GENERAL
  TOEFL_IBT
  PTE_ACADEMIC
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
}

// Payment
model Payment {
  id              String   @id @default(cuid())
  studentId       String
  student         Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  applicationId   String?
  application     Application? @relation(fields: [applicationId], references: [id])
  
  amount          Int      // VND
  type            PaymentType
  method          PaymentMethod
  
  status          PaymentStatus @default(PENDING)
  
  // Bank Transfer Details
  bankName        String?
  accountNumber   String?
  transferCode    String?
  transferDate    DateTime?
  
  // Receipt
  receiptUrl      String?
  
  verifiedAt      DateTime?
  verifiedBy      String?
  
  notes           String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

enum PaymentType {
  CONSULTATION_FEE
  APPLICATION_FEE
  VISA_SUPPORT_FEE
  DOCUMENT_TRANSLATION
  TEST_REGISTRATION
  OTHER
}

enum PaymentMethod {
  BANK_TRANSFER
  VIETQR
  MOMO
  ZALOPAY
  CASH
}

enum PaymentStatus {
  PENDING
  VERIFIED
  COMPLETED
  REJECTED
  REFUNDED
}

// Message/Chat
model Message {
  id          String   @id @default(cuid())
  studentId   String
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  consultantId String?
  consultant   Consultant? @relation(fields: [consultantId], references: [id])
  
  content     String
  isFromStudent Boolean @default(true)
  
  readAt      DateTime?
  
  createdAt   DateTime @default(now())
}

// Blog Post
model BlogPost {
  id          String   @id @default(cuid())
  slug        String   @unique
  
  title       String
  titleVi     String?
  
  excerpt     String?
  excerptVi   String?
  
  content     String
  contentVi   String?
  
  coverImage  String?
  
  category    String?
  tags        String?  // JSON array
  
  published   Boolean  @default(false)
  publishedAt DateTime?
  
  views       Int      @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}